<!DOCTYPE html>
<html>
<head>
    <title>Geometry Dash Rau M√° - Credits Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.85); color: white; z-index: 100;
        }
        .btn-group { display: flex; gap: 20px; margin-top: 20px; }
        .btn {
            padding: 15px 35px; font-size: 20px; cursor: pointer; border: none;
            border-radius: 50px; background: #2ecc71; color: white;
            font-weight: bold; transition: 0.3s; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        .btn.reset { background: #e67e22; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3); }
        .btn:hover { transform: scale(1.1); filter: brightness(1.1); }
        .credits { font-size: 14px; color: #f1c40f; margin-top: 20px; text-align: center; line-height: 1.6; }
        #music-now { font-size: 13px; color: #3498db; margin-top: 10px; font-style: italic; }
    </style>
</head>
<body>
    <div id="overlay">
        <h1 id="title" style="font-size: 50px; margin: 0; color: #2ecc71; text-shadow: 0 0 15px #2ecc71;">GEOMETRY RAU M√Å</h1>
        
        <div id="stats-area" style="text-align: center; margin: 15px 0;"></div>

        <div class="btn-group">
            <button class="btn" id="main-btn" onclick="startGame()">B·∫ÆT ƒê·∫¶U CH∆†I</button>
            <button class="btn reset" id="reset-btn" style="display:none" onclick="resetGameFull()">CH∆†I L·∫†I T·ª™ ƒê·∫¶U</button>
        </div>

        <div id="music-now">üéµ ƒêang t·∫£i nh·∫°c...</div>

        <div class="credits">
            Music by: <b>Creo, Dimrain47, Tommi Uimonen</b><br>
            <span style="color: #666; font-size: 11px;">Ph√≠m P: T·∫°m d·ª´ng | Ph√≠m N: ƒê·ªïi nh·∫°c ng·∫´u nhi√™n</span>
        </div>
    </div>

    <canvas id="g"></canvas>

    <script>
        const c = document.getElementById('g');
        const ctx = c.getContext('2d');
        const overlay = document.getElementById('overlay');
        const musicUI = document.getElementById('music-now');
        const titleUI = document.getElementById('title');
        const statsUI = document.getElementById('stats-area');
        const resetBtn = document.getElementById('reset-btn');
        const mainBtn = document.getElementById('main-btn');

        const resize = () => { c.width = window.innerWidth; c.height = window.innerHeight; };
        window.onresize = resize; resize();

        // --- C√ÄI ƒê·∫∂T NH·∫†C (music1.mp3 -> music5.mp3) ---
        const songFiles = ["music1.mp3", "music2.mp3", "music3.mp3", "music4.mp3", "music5.mp3"];
        let playlist = [...songFiles];
        let currentIdx = 0;
        const bgm = new Audio();

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function playMusic(idx) {
            currentIdx = idx % playlist.length;
            bgm.src = "music/" + playlist[currentIdx];
            musicUI.innerText = "üéµ ƒêang ph√°t: " + playlist[currentIdx];
            bgm.play().catch(() => { musicUI.innerText = "‚ö†Ô∏è Nh·∫•n b·∫Øt ƒë·∫ßu ƒë·ªÉ k√≠ch ho·∫°t nh·∫°c"; });
        }

        bgm.onended = () => playMusic(currentIdx + 1);

        // --- BI·∫æN GAME ---
        let state = 'start'; 
        let score = 0, rauMa = 0, frame = 0, speed = 8.5;
        let mode = 'cube', bgH = 250;
        let hiScore = localStorage.getItem('gdHiScore') || 0;
        let hiRauMa = localStorage.getItem('gdHiRauMa') || 0;

        const p = { x: 200, y: 0, w: 36, h: 36, dy: 0, rot: 0, gnd: false };
        let obs = [], blks = [], items = [], ports = [];
        let isPress = false;

        function startGame() {
            overlay.style.display = 'none';
            if (state === 'start' || state === 'dead') {
                shuffle(playlist);
                resetGameVars();
                playMusic(0);
            }
            state = 'playing';
            bgm.volume = 1;
            anim();
        }

        function resetGameVars() {
            score = 0; rauMa = 0; frame = 0; mode = 'cube';
            obs = []; blks = []; items = []; ports = [];
            p.y = c.height / 2; p.dy = 0; p.rot = 0;
        }

        function resetGameFull() {
            resetGameVars();
            startGame();
        }

        function checkCollision(player, o) {
            const m = 6; // Margin an to√†n
            const px = player.x + m, py = player.y + m;
            const pw = player.w - m*2, ph = player.h - m*2;
            if (px < o.x + o.w && px + pw > o.x && py < o.y + o.h && py + ph > o.y) {
                if (o.t === 'bot' && py + ph < o.y + (o.h * 0.25)) return false;
                if (o.t === 'top' && py > o.y + (o.h * 0.75)) return false;
                return true;
            }
            return false;
        }

        function die() {
            state = 'dead';
            if (score > hiScore) { hiScore = score; localStorage.setItem('gdHiScore', hiScore); }
            if (rauMa > hiRauMa) { hiRauMa = rauMa; localStorage.setItem('gdHiRauMa', hiRauMa); }
            overlay.style.display = 'flex';
            titleUI.innerText = "B·∫†N ƒê√É CH·∫æT";
            titleUI.style.color = "#e74c3c";
            statsUI.innerHTML = `<p style="font-size:20px">${Math.floor(score/10)}m - ${rauMa} rau m√°</p>`;
            mainBtn.innerText = "TH·ª¨ L·∫†I";
            resetBtn.style.display = 'none';
            bgm.volume = 0.3;
        }

        window.onkeydown = (e) => {
            if (state === 'playing') {
                if (e.code === 'Space' || e.code === 'ArrowUp') isPress = true;
                if (e.code === 'KeyP' || e.code === 'Escape') {
                    state = 'paused';
                    overlay.style.display = 'flex';
                    titleUI.innerText = "T·∫†M D·ª™NG";
                    titleUI.style.color = "#3498db";
                    mainBtn.innerText = "TI·∫æP T·ª§C";
                    resetBtn.style.display = 'block';
                    bgm.volume = 0.2;
                }
                if (e.code === 'KeyN') playMusic(currentIdx + 1);
            } else if ((state === 'dead' || state === 'start') && e.code === 'Space') {
                startGame();
            } else if (state === 'paused' && (e.code === 'KeyP' || e.code === 'Escape')) {
                startGame();
            }
        };
        window.onkeyup = (e) => isPress = false;
        window.onmousedown = () => { if(state === 'playing') isPress = true; };
        window.onmouseup = () => isPress = false;

        function spawn() {
            if (state !== 'playing') return;
            const floor = c.height - 100;
            if (frame % 85 === 0 && mode === 'cube') {
                if (Math.random() < 0.5) obs.push({x: c.width, y: floor - 42, w: 32, h: 42, t: 'bot'});
                else blks.push({x: c.width, y: floor - 130, w: 180, h: 32});
            }
            if (frame % 60 === 0) items.push({x: c.width, y: mode==='cube' ? floor-75 : 150+Math.random()*(c.height-300)});
            if ((mode === 'ship' || mode === 'wave') && frame % 22 === 0) {
                let gap = mode === 'ship' ? 190 : 160;
                let mv = Math.sin(frame/25)*(c.height/5);
                obs.push({x: c.width, y: 50, w: 60, h: (c.height/2-gap)+mv, t: 'top'});
                obs.push({x: c.width, y: floor - ((c.height/2-gap)-mv), w: 60, h: (c.height/2-gap)-mv, t: 'bot'});
            }
            if (frame % 500 === 0) {
                const list = ['cube', 'ship', 'wave'].filter(m => m !== mode);
                ports.push({x: c.width, y: 50, w: 70, h: floor-50, to: list[Math.floor(Math.random()*list.length)]});
            }
        }

        function anim() {
            if (state !== 'playing') return;
            frame++; score++;
            const floor = c.height - 100, ceil = 50;
            bgH = (bgH + 0.2) % 360;
            ctx.fillStyle = `hsla(${bgH}, 40%, 5%, 1)`;
            ctx.fillRect(0,0,c.width,c.height);

            if (mode === 'ship') { p.dy += (isPress ? -0.8 : 0.7); p.dy *= 0.98; p.rot = p.dy*2.5; }
            else if (mode === 'wave') { p.dy = isPress ? -9 : 9; p.rot = isPress ? -45 : 45; }
            else { 
                p.dy += 1.25; if(isPress && p.gnd) p.dy = -15.5; 
                if(!p.gnd) p.rot += 6; else p.rot = Math.round(p.rot/90)*90;
            }
            p.y += p.dy;
            if(p.y > floor-p.h){ p.y = floor-p.h; p.dy = 0; p.gnd = true; }
            else if(p.y < ceil){ p.y = ceil; p.dy = 0; } else p.gnd = false;

            ctx.fillStyle = `hsl(${bgH}, 100%, 50%)`;
            ctx.fillRect(0, floor, c.width, 10); ctx.fillRect(0, ceil-10, c.width, 10);

            blks.forEach((b, i) => {
                b.x -= speed; ctx.fillStyle = '#333'; ctx.fillRect(b.x, b.y, b.w, b.h);
                if(p.x < b.x+b.w && p.x+p.w > b.x && p.y+p.h > b.y && p.y < b.y+b.h) {
                    if(p.dy > 0 && p.y+p.h < b.y+20){ p.y = b.y-p.h; p.dy = 0; p.gnd = true; } else die();
                }
                if(b.x < -200) blks.splice(i, 1);
            });

            obs.forEach((o, i) => {
                o.x -= speed; ctx.fillStyle = '#f44';
                ctx.beginPath();
                if(o.t === 'top') {
                    ctx.moveTo(o.x, 50); ctx.lineTo(o.x+o.w, 50); ctx.lineTo(o.x+o.w/2, 50+o.h);
                } else {
                    ctx.moveTo(o.x, floor); ctx.lineTo(o.x+o.w, floor); ctx.lineTo(o.x+o.w/2, floor-o.h);
                }
                ctx.fill();
                if(checkCollision(p, o)) die();
                if(o.x < -100) obs.splice(i, 1);
            });

            ports.forEach((o, i) => {
                o.x -= speed; ctx.fillStyle = o.to==='wave'?'#0ff':o.to==='ship'?'#ff0':'#0f0';
                ctx.globalAlpha = 0.3; ctx.fillRect(o.x, o.y, o.w, o.h); ctx.globalAlpha = 1;
                if(p.x+p.w > o.x && p.x < o.x+o.w) mode = o.to;
                if(o.x < -100) ports.splice(i, 1);
            });

            items.forEach((m, i) => {
                m.x -= speed; ctx.fillStyle = '#2ecc71'; ctx.beginPath(); ctx.arc(m.x, m.y, 12, 0, 7); ctx.fill();
                if(Math.hypot(p.x+18-m.x, p.y+18-m.y) < 35){ items.splice(i, 1); rauMa++; }
                if(m.x < -100) items.splice(i, 1);
            });

            // Player
            ctx.save(); ctx.translate(p.x+p.w/2, p.y+p.h/2); ctx.rotate(p.rot*Math.PI/180);
            let pC = mode==='ship'?'#ff0':mode==='wave'?'#0ff':'#0f0';
            ctx.fillStyle = pC; ctx.shadowBlur = 15; ctx.shadowColor = pC;
            ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.strokeRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();

            // UI
            ctx.fillStyle = '#fff'; ctx.font = 'bold 18px Arial'; ctx.textAlign = 'left'; ctx.shadowBlur = 0;
            ctx.fillText(`RAU M√Å: ${rauMa}`, 30, 40);
            ctx.textAlign = 'right';
            ctx.fillText(`K·ª∂ L·ª§C: ${Math.floor(hiScore/10)}m`, c.width-30, 40);
            ctx.fillText(`HI·ªÜN T·∫†I: ${Math.floor(score/10)}m`, c.width-30, 70);

            requestAnimationFrame(anim);
        }

        setInterval(spawn, 50);
        musicUI.innerText = "üéµ S·∫µn s√†ng ph√°t: " + songFiles.length + " b√†i nh·∫°c";
    </script>
</body>
</html>